{% extends 'base.html.twig' %}

{% block title %}Debug Excel Upload{% endblock %}

{% block body %}
<div class="container mt-4">
    <h2>Debug Excel Upload</h2>
    
    <div class="row mb-3">
        <div class="col-md-6">
            {{ form_start(form) }}
            {{ form_widget(form) }}
            <button type="submit" class="btn btn-primary">Upload and Debug</button>
            {{ form_end(form) }}
        </div>
        <div class="col-md-6">
            <a href="{{ path('seed_bras') }}" class="btn btn-success">Seed BRAS Entities</a>
        </div>
    </div>
    
    {% if debugData is defined %}
        <div class="mt-4">
            <h3>Excel Data Structure (First 15 rows)</h3>
            <p><strong>Total rows:</strong> {{ totalRows }}</p>
            
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Row</th>
                            <th>A</th>
                            <th>B</th>
                            <th>C</th>
                            <th>D</th>
                            <th>E</th>
                            <th>F</th>
                            <th>G</th>
                            <th>H</th>
                            <th>I</th>
                            <th>J</th>
                            <th>K</th>
                            <th>L</th>
                            <th>M</th>
                            <th>N</th>
                            <th>O</th>
                            <th>P</th>
                            <th>Full Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in debugData %}
                        <tr>
                            <td><strong>{{ row.row }}</strong></td>
                            {% for i in 0..15 %}
                                <td style="max-width: 80px; overflow: hidden; font-size: 11px;">
                                    {{ row.data[i] ?? 'null' }}
                                </td>
                            {% endfor %}
                            <td style="max-width: 200px; overflow: hidden; font-size: 10px;">
                                <details>
                                    <summary>View All</summary>
                                    {{ row.data|json_encode }}
                                </details>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <h3>BRAS Entities in Database</h3>
            {% if brasNames is not empty %}
                <ul>
                    {% for bras in brasNames %}
                        <li>{{ bras }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-warning">No BRAS entities found in database. Click "Seed BRAS Entities" to create them.</p>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}